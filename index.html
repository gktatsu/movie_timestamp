


    <!DOCTYPE html>
    <html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>YouTube Live ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚¢ãƒ—ãƒª</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
    
            :root {
                --primary-color: #FF4136;
                --secondary-color: #7FDBFF;
                --background-color: #FFDC00;
                --text-color: #111111;
                --border-color: #DDDDDD;
                --error-color: #85144b;
            }
    
            * {
                box-sizing: border-box;
                transition: all 0.3s ease;
            }
    
            body {
                font-family: 'Poppins', sans-serif;
                line-height: 1.6;
                margin: 0;
                padding: 0;
                background: linear-gradient(135deg, var(--background-color), #FF851B);
                color: var(--text-color);
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
            }
    
            .container {
                max-width: 800px;
                margin: 0 auto;
                padding: 2rem;
                background-color: rgba(255, 255, 255, 0.9);
                border-radius: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                width: 100%;
                text-align: center;
            }
    
            .header {
                text-align: center;
                margin-bottom: 2rem;
            }
    
            .logo {
                font-size: 3rem;
                font-weight: 600;
                color: var(--primary-color);
                text-shadow: 2px 2px var(--secondary-color);
            }
    
            h1 {
                font-weight: 300;
                font-size: 2rem;
                margin-top: 0.5rem;
                color: var(--text-color);
            }
    
            .input-section {
                display: flex;
                margin-bottom: 2rem;
                gap: 1rem;
            }
    
            #youtubeLinkInput {
                flex-grow: 1;
                padding: 0.75rem;
                font-size: 1rem;
                border: 2px solid var(--border-color);
                border-radius: 20px;
                transition: all 0.3s ease;
            }
    
            #youtubeLinkInput:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 10px rgba(255, 65, 54, 0.3);
            }
    
            button {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
                background-color: var(--primary-color);
                color: white;
                border: none;
                border-radius: 20px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-weight: 600;
            }
    
            button:hover {
                background-color: #E7040F;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            }
    
            button:active {
                transform: translateY(0);
            }
    
            #loadVideoButton {
                background-color: var(--secondary-color);
                color: var(--text-color);
            }
    
            #loadVideoButton:hover {
                background-color: #39CCCC;
            }
    
            /* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’16:9ã«ã™ã‚‹ãŸã‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
            .player-wrapper {
                position: relative;
                width: 100%;
                padding-bottom: 56.25%;
                height: 0;
                margin-bottom: 2rem;
            }
    
            #player {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                border-radius: 20px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }
    
            #getTimestamp {
                display: block;
                width: 100%;
                margin-bottom: 2rem;
                background-color: #2ECC40;
            }
    
            #getTimestamp:hover {
                background-color: #01FF70;
            }
    
            #getTimestamp:disabled {
                background-color: var(--border-color);
                cursor: not-allowed;
            }
    
            #timestampEntries {
                list-style-type: none;
                padding: 0;
            }
    
            .timestamp-entry {
                display: flex;
                align-items: center;
                margin-bottom: 1rem;
                padding: 1rem;
                background-color: white;
                border-radius: 20px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                transition: all 0.3s ease;
            }
    
            .timestamp-entry:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            }
    
            .timestamp-entry button {
                margin-right: 1rem;
                padding: 0.5rem 1rem;
                background-color: var(--secondary-color);
                color: var(--text-color);
            }
    
            .timestamp-entry button:hover {
                background-color: #39CCCC;
            }
    
            .timestamp-entry span {
                font-weight: bold;
                margin-right: 1rem;
            }
    
            .timestamp-entry input {
                flex-grow: 1;
                padding: 0.5rem;
                border: 1px solid var(--border-color);
                border-radius: 20px;
                font-size: 1rem;
                transition: all 0.3s ease;
            }
    
            .timestamp-entry input:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 10px rgba(255, 65, 54, 0.3);
            }
    
            .timestamp-entry .delete-button {
                margin-left: 1rem;
                background-color: var(--error-color);
                color: white;
            }
    
            .timestamp-entry .delete-button:hover {
                background-color: #B10DC9;
            }
    
            #errorMessage {
                display: none;
                color: var(--error-color);
                margin-top: 1rem;
                font-weight: bold;
                text-align: center;
                padding: 1rem;
                background-color: rgba(255, 255, 255, 0.8);
                border-radius: 20px;
                border: 2px solid var(--error-color);
            }
    
            #loadingIndicator {
                display: none;
                text-align: center;
                margin-top: 1rem;
                font-style: italic;
                color: var(--primary-color);
                font-weight: 600;
            }
    
            select {
                padding: 0.5rem;
                font-size: 1rem;
                border: 2px solid var(--border-color);
                border-radius: 20px;
                background-color: white;
                margin-bottom: 1rem;
                width: 100%;
                cursor: pointer;
            }
    
            select:focus {
                outline: none;
                border-color: var(--primary-color);
                box-shadow: 0 0 10px rgba(255, 65, 54, 0.3);
            }
    
            label {
                display: block;
                margin-bottom: 0.5rem;
                font-weight: 600;
            }
    
            #endViewingButton {
                background-color: #3D9970;
                color: white;
                width: 100%;
                margin-top: 2rem;
            }
    
            #endViewingButton:hover {
                background-color: #2ECC40;
            }
    
            @media (max-width: 600px) {
                .container {
                    padding: 1rem;
                }
    
                .input-section {
                    flex-direction: column;
                }
    
                #youtubeLinkInput, #loadVideoButton {
                    width: 100%;
                }
    
                .timestamp-entry {
                    flex-wrap: wrap;
                }
    
                .timestamp-entry button, .timestamp-entry span {
                    margin-bottom: 0.5rem;
                }
    
                .timestamp-entry input {
                    width: 100%;
                    margin-bottom: 0.5rem;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <div class="logo">ğŸ“º</div>
                <h1>YouTube Live ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— ã‚¢ãƒ—ãƒª</h1>
            </div>
            <div class="input-section">
                <input type="text" id="youtubeLinkInput" placeholder="YouTube Live URLã‚’å…¥åŠ›">
                <button id="loadVideoButton">å‹•ç”»ã‚’èª­ã¿è¾¼ã‚€</button>
            </div>
            <div id="errorMessage"></div>
            <div id="loadingIndicator">å‹•ç”»ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>
    
            <div class="player-wrapper">
                <div id="player"></div>
            </div>
    
            <label for="timeOffset">ä½•ç§’å‰ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¨˜éŒ²ã—ã¾ã™ã‹ï¼Ÿ</label>
            <select id="timeOffset">
                <option value="0">ç¾åœ¨ã®æ™‚åˆ»</option>
                <option value="30">30ç§’å‰</option>
                <option value="60">1åˆ†å‰</option>
            </select>
            <button id="getTimestamp" disabled>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¨˜éŒ²</button>
            <label for="sortOrder">ä¸¦ã³é †</label>
            <select id="sortOrder">
                <option value="newest">æ–°ã—ã„é †</option>
                <option value="oldest">å¤ã„é †</option>
            </select>
            <ul id="timestampEntries"></ul>
    
            <!-- ã‚¨ã‚¯ã‚»ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½ -->
            <label for="importFile">ã‚¨ã‚¯ã‚»ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å¾©å…ƒ</label>
            <input type="file" id="importFile" accept=".xlsx">
            <button id="importExcelButton">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
    
            <button id="endViewingButton" disabled>è¦–è´çµ‚äº† & ã‚¨ã‚¯ã‚»ãƒ«å‡ºåŠ›</button>
        </div>
    
        <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
        <script>
            let player;
            let videoId = '';
            let currentVideoTitle = '';
            let currentVideoUrl = '';
    
            // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã”ã¨ã®å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ã¨URLã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ãƒªã‚¹ãƒˆ
            let timestamps = [];
    
            // YouTube APIã®èª­ã¿è¾¼ã¿
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    
            function onYouTubeIframeAPIReady() {
                console.log('YouTube IFrame API is ready');
            }
    
            document.getElementById('loadVideoButton').addEventListener('click', loadVideo);
            document.getElementById('getTimestamp').addEventListener('click', addTimestamp);
            document.getElementById('endViewingButton').addEventListener('click', saveToExcel);
            document.getElementById('importExcelButton').addEventListener('click', importExcel);
            document.getElementById('sortOrder').addEventListener('change', sortTimestamps);
    
            // å‹•ç”»ã‚’èª­ã¿è¾¼ã‚€
            function loadVideo() {
                const url = document.getElementById('youtubeLinkInput').value;
                videoId = extractVideoId(url);
                currentVideoUrl = url; // å‹•ç”»ã®URLã‚’ä¿å­˜
    
                if (videoId) {
                    document.getElementById('errorMessage').style.display = 'none'; // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éè¡¨ç¤º
                    document.getElementById('loadingIndicator').style.display = 'block'; // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
    
                    if (player) {
                        player.loadVideoById(videoId);
                    } else {
                        player = new YT.Player('player', {
                            videoId: videoId,
                            events: {
                                'onReady': onPlayerReady,
                                'onError': onPlayerError
                            }
                        });
                    }
                    resetTimestamps();
                } else {
                    document.getElementById('errorMessage').textContent = 'ç„¡åŠ¹ãªYouTube URLã§ã™ã€‚æ­£ã—ã„URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                    document.getElementById('errorMessage').style.display = 'block'; // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    document.getElementById('loadingIndicator').style.display = 'none'; // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’éè¡¨ç¤º
                }
            }
    
            function onPlayerReady(event) {
                document.getElementById('getTimestamp').disabled = false;
                document.getElementById('endViewingButton').disabled = false;
                document.getElementById('loadingIndicator').style.display = 'none';
            }
    
            function onPlayerError(event) {
                document.getElementById('errorMessage').textContent = 'å‹•ç”»ã®èª­ã¿è¾¼ã¿ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚URLã‚’ç¢ºèªã—ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚';
                document.getElementById('errorMessage').style.display = 'block'; // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                document.getElementById('loadingIndicator').style.display = 'none'; // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’éè¡¨ç¤º
            }
    
            function extractVideoId(url) {
                const regExp = /(?:youtube(?:-nocookie)?.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
                const match = url.match(regExp);
                return (match && match[1].length === 11) ? match[1] : null;
            }
    
            // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¿½åŠ ã™ã‚‹
            function addTimestamp() {
                const currentTime = player.getCurrentTime();
                const offset = parseInt(document.getElementById('timeOffset').value, 10);
                let targetTime = currentTime - offset;
    
                if (targetTime < 0) {
                    targetTime = 0;
                }
    
                const formattedTime = formatTime(targetTime);
                const timestampEntries = document.getElementById('timestampEntries');
    
                const li = document.createElement('li');
                li.className = 'timestamp-entry';
                li.innerHTML = `
                    <button onclick="seekTo(${targetTime})">å†ç”Ÿ</button>
                    <span>${formattedTime}</span>
                    <input type="text" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›">
                    <button class="delete-button" onclick="deleteTimestamp(this)">å‰Šé™¤</button>
                `;
    
                // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¨ãã®æ™‚ç‚¹ã§ã®å‹•ç”»æƒ…å ±ã‚’ä¿å­˜
                currentVideoTitle = player.getVideoData().title;  // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æŠ¼ã—ãŸæ™‚ç‚¹ã§ã®å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ã‚’å–å¾—
                timestamps.push({
                    time: formattedTime,
                    videoTitle: currentVideoTitle,
                    videoUrl: currentVideoUrl,
                    comment: ''
                });
    
                const sortOrder = document.getElementById('sortOrder').value;
                if (sortOrder === 'newest') {
                    timestampEntries.insertBefore(li, timestampEntries.firstChild);
                } else {
                    timestampEntries.appendChild(li);
                }
            }
    
            function formatTime(time) {
                const minutes = Math.floor(time / 60);
                const seconds = Math.floor(time % 60);
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
    
            function seekTo(time) {
                player.seekTo(time);
                player.playVideo();
            }
    
            function resetTimestamps() {
                document.getElementById('timestampEntries').innerHTML = '';
                timestamps = []; // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãƒ‡ãƒ¼ã‚¿ã‚‚ãƒªã‚»ãƒƒãƒˆ
            }
    
            function deleteTimestamp(element) {
                const li = element.parentElement;
                li.remove();
            }
    
            function sortTimestamps() {
                const timestampEntries = document.getElementById('timestampEntries');
                const timestampsArray = Array.from(timestampEntries.children);
                const sortOrder = document.getElementById('sortOrder').value;
    
                timestampsArray.sort((a, b) => {
                    const timeA = a.querySelector('span').textContent;
                    const timeB = b.querySelector('span').textContent;
                    return sortOrder === 'newest' ? timeB.localeCompare(timeA) : timeA.localeCompare(timeB);
                });
    
                timestampsArray.forEach(timestamp => timestampEntries.appendChild(timestamp));
            }
    
            // ã‚¨ã‚¯ã‚»ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜æ©Ÿèƒ½
            function saveToExcel() {
                const timestampEntries = document.querySelectorAll('.timestamp-entry');
                const data = [];
    
                // å‹•ç”»æƒ…å ±ã‚’å–å¾—ã—ã¦ã‹ã‚‰æŒ¿å…¥
                if (timestamps.length > 0) {
                    // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€æœ€æ–°ã®å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ã¨URLã‚’åæ˜ 
                    const latestVideoTitle = timestamps[timestamps.length - 1].videoTitle;
                    const latestVideoUrl = timestamps[timestamps.length - 1].videoUrl;
    
                    data.push({ A: 'ã‚¿ã‚¤ãƒˆãƒ«', B: latestVideoTitle });
                    data.push({ A: 'URL', B: latestVideoUrl });
                } else {
                    // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ç¾åœ¨ã®å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ã¨URL
                    data.push({ A: 'ã‚¿ã‚¤ãƒˆãƒ«', B: currentVideoTitle });
                    data.push({ A: 'URL', B: currentVideoUrl });
                }
    
                data.push({ A: 'ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—', B: 'ã‚³ãƒ¡ãƒ³ãƒˆ' });
    
                // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŒ¿å…¥
                timestampEntries.forEach((entry, index) => {
                    const time = entry.querySelector('span').innerText;
                    const comment = entry.querySelector('input').value;
    
                    // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æƒ…å ±ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’åæ˜ 
                    timestamps[index].comment = comment;
    
                    data.push({ A: time, B: comment });
                });
    
                // ã‚·ãƒ¼ãƒˆä½œæˆ
                const ws = XLSX.utils.json_to_sheet(data, { header: ['A', 'B'], skipHeader: true });
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Timestamps');
    
                // ã‚¨ã‚¯ã‚»ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
                XLSX.writeFile(wb, 'timestamps.xlsx');
            }
    
            // ã‚¨ã‚¯ã‚»ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ©Ÿèƒ½
            function importExcel() {
                const fileInput = document.getElementById('importFile').files[0];
                if (!fileInput) {
                    alert("ã‚¨ã‚¯ã‚»ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„");
                    return;
                }
    
                const reader = new FileReader();
                reader.onload = function (e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
    
                    const sheet = workbook.Sheets['Timestamps'];
                    const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
    
                    // 1è¡Œç›®ã¨2è¡Œç›®ã‹ã‚‰å‹•ç”»ã®æƒ…å ±ã‚’å–å¾—
                    currentVideoTitle = rows[0][1]; // B1: å‹•ç”»ã®ã‚¿ã‚¤ãƒˆãƒ«
                    currentVideoUrl = rows[1][1]; // B2: å‹•ç”»ã®URL
                    videoId = extractVideoId(currentVideoUrl);
    
                    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å‹•ç”»ã‚’ãƒ­ãƒ¼ãƒ‰
                    document.getElementById('youtubeLinkInput').value = currentVideoUrl;
                    loadVideo();
    
                    // 4è¡Œç›®ä»¥é™ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’å¾©å…ƒ
                    resetTimestamps();
                    for (let i = 3; i < rows.length; i++) {
                        const time = rows[i][0];
                        const comment = rows[i][1];
                        addRestoredTimestamp(time, comment);
                    }
                };
                reader.readAsArrayBuffer(fileInput);
            }
    
            // å¾©å…ƒã•ã‚ŒãŸã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¡¨ç¤ºã™ã‚‹
            function addRestoredTimestamp(time, comment) {
                const timestampEntries = document.getElementById('timestampEntries');
    
                const li = document.createElement('li');
                li.className = 'timestamp-entry';
                li.innerHTML = `
                    <button onclick="seekTo(${parseTime(time)})">å†ç”Ÿ</button>
                    <span>${time}</span>
                    <input type="text" value="${comment}">
                    <button class="delete-button" onclick="deleteTimestamp(this)">å‰Šé™¤</button>
                `;
    
                timestamps.push({
                    time: time,
                    videoTitle: currentVideoTitle,
                    videoUrl: currentVideoUrl,
                    comment: comment
                });
    
                const sortOrder = document.getElementById('sortOrder').value;
                if (sortOrder === 'newest') {
                    timestampEntries.insertBefore(li, timestampEntries.firstChild);
                } else {
                    timestampEntries.appendChild(li);
                }
            }
    
            // æ™‚é–“ã‚’åˆ†:ç§’å½¢å¼ã‹ã‚‰ç§’æ•°ã«å¤‰æ›
            function parseTime(timeString) {
                const [minutes, seconds] = timeString.split(':').map(Number);
                return minutes * 60 + seconds;
            }
        </script>
    </body>
    </html>
    